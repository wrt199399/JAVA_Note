# 一、网络协议原理

## 1 引出

为何需要高并发？营销带来的大安装量

通过日志分析渠道流量，转化率，购买力，进而精准投放营销广告

中国在向服务行业转型

什么是网络协议模型？为什么分层？

OSI参考模型，软件工程中的学问：分层解耦。

## 2 五层模型

在TCP协议的应用中暂且分为5层

1.应用层协议：http,  SSH , 

​	什么是http协议 

​	建立连接，传送数据

​	建立连接的过程是应用程序通过调用操作系统内核去申请建立socket连接，这个步骤是下面四层流程完成的。

2.传输控制层

​	传输控制层有哪些协议？TCP，UDP

​	TCP？面向连接的可靠的传输方式

​	什么叫面向连接？三次握手，四次分手

​	为什么需要三次握手？1.发送请求，2.对方回发确认收到请求，3.我方再回发确认收到

​	三次握手之后才会开辟资源，拿到 IO ，才会发送数据。

​	为什么需要四次分手？资源回收，端口号有限，不能一直占着

​	为什么四次？1.发送请求分开，2.对方回发确认，3.对方发送请求分开，4.回复确认

​	三次握手 - 传输数据 - 四次分手  成为一个最小粒度，不可被分割

3.网络层

​	IP：点分字节，一个唯一地址

​	掩码：用来和 IP 进行位于运算，与完得出一个网络号

​	网关：当前网段的出口，也就是下一跳的地址	

​	DNS：用作域名解析，将域名发送到DNS服务器后，返回一个目标IP

​	路由表 route-n 做路由判定 ：目标IP和路由表中的掩码做与运算，得出的值匹配路由表中的目标网络号，最终找到的出口就是默认网关

​	IP地址和网关进行按位与运算得出当前机器所在的网络段号

​	下一跳机制：每一个互联网设备不需要存全网设备的地址，只需要存下一跳的地址

​	

​	那目标地址怎么找？交给链路层

4.链路层

​	arp - a  ARP 协议，根据ip地址找到mac地址

​	怎么根据ip找到mac地址的呢？ 源主机将自己的mac地址和目标ip封一个包发向交换机，交换机广播寻找匹配对应的ip，然后目标ip主机收到广播后，将自己的mac地址和目标mac地址封包发送回去。

结论：TCP/IP协议是基于下一跳的机制，IP是端点间，MAC地址是网络节点之间

5.物理层

​	网卡，网线，集线器，中继器，调制解调器 等物理设备 ，维护，断开物理连接，数字信号转为电信号，实现比特流传输

## 3.lvs和Nginx

LVS和Nginx的区别

lvs关心的是4层中的内容，偷窥端口状态，直接做负载转发。

nginx关心的是七层，建立好socket链接根据请求内容做负载均衡。

